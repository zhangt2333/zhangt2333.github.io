<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 3.9.0"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>一个纯Java纯TCP协议的即时通讯程序HIM - Zhang T&#39;s Blog</title><link rel="icon" href="/images/favicon.svg"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><link rel="stylesheet" href="/css/back-to-top.css"><link rel="stylesheet" href="/css/progressbar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><link rel="stylesheet" href="/css/style.css"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand is-flex-center"><a class="navbar-item navbar-logo" href="/">TTTT&#39;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a> <a class="navbar-item" href="/archives">归档</a> <a class="navbar-item" href="/categories">分类</a> <a class="navbar-item" href="/tags">标签</a> <a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" title="GitHub" href="https://github.com/zhangt2333"><i class="fab fa-github"></i> </a><a class="navbar-item" target="_blank" title="E-mail" href="mailto:zhangt2333@gmail.com"><i class="fa fa-envelope-open"></i> </a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i> </a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card"><div class="card-content article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>一个纯Java纯TCP协议的即时通讯程序HIM</h1><div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto"><div class="level-left"><time class="level-item has-text-grey" datetime="2018-06-02T16:23:00.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2018-06-03</time> <time class="level-item has-text-grey is-hidden-mobile" datetime="2021-11-09T04:18:01.487Z"><i class="far fa-calendar-check">&nbsp;</i>2021-11-09</time><div class="level-item"><i class="far fa-folder-open has-text-grey"></i>&nbsp; <a class="has-link-grey -link" href="/categories/Programing/">Programing</a></div><span class="level-item has-text-grey"><i class="far fa-clock"></i>&nbsp; 22 分钟 读完 (大约 3262 个字) </span><span class="level-item has-text-grey" id="busuanzi_container_page_pv"><i class="far fa-eye"></i> <span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><div class="content"><h1 id="HIM"><a href="#HIM" class="headerlink" title="HIM"></a>HIM</h1><p>一个纯Java纯TCP协议的即时通讯程序。HIM即<code>Here I am</code> or <code>Here Instant Message</code>，来自于我的【高级程序设计语言课程设计】课程，对服务端和客户端通信部分开源。</p><a id="more"></a><p><img src="https://img.shields.io/badge/version-v1.0-blue.svg" alt="version"> <img src="https://img.shields.io/badge/java-1.8.0-green.svg" alt="jdk"> <img src="https://img.shields.io/badge/mysql-v5.7-brightgreen.svg" alt="mysql"> <a href="https://opensource.org/licenses/Apache-2.0" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/licence-Apache2.0-blue.svg" alt="licence"></a><img src="https://img.shields.io/badge/netIO-TCP/IP-green.svg" alt="netIO"></p><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul><li><p><a href="#课设要求">课设要求</a></p></li><li><p><a href="#服务端架设">服务端架设</a></p><ul><li>Windows</li><li>Linux</li></ul></li><li><p><a href="#项目介绍">项目介绍</a></p><ul><li>目录结构</li><li>服务端原理简单阐述</li></ul></li><li><p><a href="#开发历程">开发历程</a></p><ul><li>前言</li><li>需求分析</li><li>数据库建模</li><li>数据访问层设计</li><li>缓存数据设计</li><li>通讯协议层设计</li></ul></li></ul><h2 id="课设要求"><a href="#课设要求" class="headerlink" title="课设要求"></a>课设要求</h2><blockquote><p><strong>题目名称：Mini QQ</strong><br>基本要求：<br>本次设计要求利用Java实现支持2-N人联机的迷你QQ应用程序PC版，支持如下基本需求:</p><ul><li><p>仿照腾讯QQ开发系统的应用功能（通过模仿和自己创意）。</p></li><li><p>必备功能：</p><ul><li><input checked disabled type="checkbox"><p>二人即时聊天</p></li><li><input checked disabled type="checkbox"><p>群聊功能</p></li><li><input checked disabled type="checkbox"><p>传递文件（在线传、离线传）</p></li><li><input checked disabled type="checkbox"><p>实时发送表情与图片、视频</p></li><li><input checked disabled type="checkbox"><p>即时手动画图功能——画者所画，双方实时可见</p></li></ul></li><li><p>拓展功能：</p><ul><li><input disabled type="checkbox"> 在现有腾讯QQ已有功能的启发下，创新开发出更多的应用功能</li></ul></li></ul></blockquote><h2 id="服务端架设"><a href="#服务端架设" class="headerlink" title="服务端架设"></a>服务端架设</h2><p>有没有办法能马上用上这个服务端呢？有，所以我把这章节置前了。</p><ul><li><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4></li></ul><ol><li><p>安装好Java，并配置好环境变量，我的版本是 “JDK1.8.0_131”(在cmd中输入java -version即可显示版本)。</p></li><li><p><a href="http://www.jb51.net/article/23876.htm" target="_blank" rel="noopener">安装好MySQL</a>，由于喜好精简，于是开发环境版本是”v5.0.96”，当然在linux下”v5.7.21”也成功了。</p></li><li><p>进入MySQL，建立一个数据库：</p><p>(1). 在命令行输入：<code>mysql -u root -p</code>，再输入密码进入数据库</p><p>(2). 输入 <code>CREATE DATABASE HIM_Db CHARACTER SET UTF8;</code></p><p>(3). 关于建表，com.HIM.server.Db_Init是自动建表的类</p></li><li><p>把本仓库源码下载，使用eclipse对目录建立Java Project，在src/com/HIM/server下有Main.java，即main方法所在地。</p></li><li><p>在启动服务端前还有一件事就是配置<a href="https://github.com/zhangt2333/HIM/tree/master/HIM_server.properties" target="_blank" rel="noopener">HIM_server.properties</a>文件，该文件在项目目录下，尤其注意”JDBC基本信息”的配置。</p></li><li><p>先启动服务端，<del>再启动客户端</del>(昂，客户端没开源，不过我会上传打包好的程序到release的)</p><ul><li><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4></li></ul></li><li><p>部署完成后用Putty连接服务器，上来先更新：</p><p><code>$ sudo apt-get update</code></p><p><code>$ sudo apt-get upgrade</code></p></li><li><p>然后是安装Mysql:</p><p><code>$ sudo apt-get install mysql-server</code></p></li><li><p>修改它的配置：</p><p><code>$ vim /etc/mysql/mysql.conf.d/mysqld.cnf</code></p><p>将bind-address = 127.0.0.1这行使用#注释掉，并且在[mysqld]字段后加上 character-set-server=utf8。由此实现开发环境连接生产环境数据库，和解决编码问题。</p></li><li><p>然后是安装JDK:</p><p><code>$ sudo apt-get install default-jdk</code></p></li><li><p>配置好<a href="https://github.com/zhangt2333/HIM/tree/master/HIM_server.properties" target="_blank" rel="noopener">HIM_server.properties</a>文件先，该文件在项目目录下，尤其注意”JDBC基本信息”的配置。</p></li><li><p>创建一个项目目录，用<strong>SFTP</strong>把项目传上去：</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">psftp&gt; open xx.xx.xxx.xx                               //你的服务器ip</span><br><span class="line">login as: root                                         //输入用户名和密码了</span><br><span class="line">root@xx.xx.xxx.xx&apos;s password:</span><br><span class="line">Remote working directory is /root</span><br><span class="line">psftp&gt; sudo mkdir /var/tttt/HIM_server                  //我创的项目目录</span><br><span class="line">psftp&gt; put -r t:/桌面/HIM/ /var/tttt/HIM_server/</span><br></pre></td></tr></table></figure></li><li><p>SSH中后台挂起服务端：</p><p><code>$ nohup java -jar /var/tttt/HIM_server/HIM_server.jar &gt;&gt; log/log.txt &amp;</code></p><p>若要实时调试则输入：``$ java -jar /var/tttt/HIM_server/HIM_server.jar test `</p></li><li><p><del>启动客户端</del></p></li></ol><h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><ul><li><h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">HIM</span><br><span class="line">├─src</span><br><span class="line">│  └─com</span><br><span class="line">│      └─HIM</span><br><span class="line">│          ├─client</span><br><span class="line">│          │      FileTransfer.java              //托管文件传输的类</span><br><span class="line">│          │      Server_API.java                //与服务端通信的api</span><br><span class="line">│          │      Thread_receiver.java           //纯接收服务端信息的线程</span><br><span class="line">│          │      YouDrawMeGuessComm.java        //实时画图数据传输者</span><br><span class="line">│          │      ...</span><br><span class="line">│          ├─common                              //一些Bean类和工具类</span><br><span class="line">│          │      Bean_fileinfo.java</span><br><span class="line">│          │      Bean_friendinfo.java</span><br><span class="line">│          │      Bean_message.java</span><br><span class="line">│          │      Bean_mood.java</span><br><span class="line">│          │      Bean_picture.java</span><br><span class="line">│          │      Bean_quninfo.java</span><br><span class="line">│          │      Bean_subgroup.java</span><br><span class="line">│          │      Bean_userinfo.java</span><br><span class="line">│          │      Enum_constellation.java</span><br><span class="line">│          │      Enum_sex.java</span><br><span class="line">│          │      logger.java</span><br><span class="line">│          │      SubGroupManager.java</span><br><span class="line">│          │      tools.java</span><br><span class="line">│          └─server</span><br><span class="line">│                  config.java                          </span><br><span class="line">│                  Db_C3P0_ConnectionPoolUtil.java      //数据库连接池     </span><br><span class="line">│                  Db_Init.java                         //数据库初始化类</span><br><span class="line">│                  Db_Operate.java                      //数据库操作类</span><br><span class="line">│                  logger.java                          //日志记录类</span><br><span class="line">│                  Main.java</span><br><span class="line">│                  OnlineUserManager.java               //在线用户管理类</span><br><span class="line">│                  QunMessageManager.java               //群功能托管类</span><br><span class="line">│                  ServerThreadsManager.java            //连接线程管理类</span><br><span class="line">│                  Thread_CommandLineControl.java       //命令行界面控制类</span><br><span class="line">│                  Thread_Greeter.java                  //ServerSocket</span><br><span class="line">│                  Thread_Server.java                   //响应客服端请求</span><br><span class="line">└─test</span><br><span class="line">    └─com</span><br><span class="line">        └─HIM</span><br><span class="line">            └─test                 </span><br><span class="line">                ├─client</span><br><span class="line">                │      Demo_ChatPanel.java</span><br><span class="line">                │      Demo_test.java</span><br><span class="line">                │      FileTransfer_test.java</span><br><span class="line">                │      Server_API_test.java</span><br><span class="line">                │      TesterConfig.java</span><br><span class="line">                │      YouDrawMeGuessComm_test.java</span><br><span class="line">                └─server</span><br><span class="line">                       Db_Operate_test.java</span><br></pre></td></tr></table></figure></li><li><h4 id="服务端原理简单阐述（接下来要施展口技了）"><a href="#服务端原理简单阐述（接下来要施展口技了）" class="headerlink" title="服务端原理简单阐述（接下来要施展口技了）"></a>服务端原理简单阐述（<del>接下来要施展口技了</del>）</h4><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">业务处理的实现：（模型:客户端&lt;-&gt;TCP&lt;-&gt;服务端&lt;-&gt;JDBC&lt;-&gt;Mysql数据库）</span><br><span class="line">1.客户端——Socket-&gt;服务端</span><br><span class="line">2.服务端——JDBC-&gt;MySQL</span><br><span class="line">3.MySQL——处理完-&gt;服务端</span><br><span class="line">4.服务端——Socket-&gt;客户端</span><br><span class="line"> </span><br><span class="line">聊天功能的实现：（由于是纯TCP且客户端之前不连接，故客户端间通讯都是通过服务器中介）</span><br><span class="line">1.客户登录后，把其接收者线程&lt;int UserID-&gt;String&quot;IP:Port&quot;&gt;信息put进一个管理OnlineUser的HashMap里面。</span><br><span class="line">2.当客户端发送消息Bean_message后，取出其中的接受者ID，拿到OnlineUser的HashMap中映射一下，有则接而将得到的String&quot;IP:Port&quot;在ServerThread的HashMap映射得到线程，将message通过线程中的Object流写出。</span><br><span class="line"></span><br><span class="line">群聊功能的实现：维护一个&lt;群号-&gt;群成员数组&gt;的Map，里面就是服务器拿到message后判断为群消息类型进而对群中每一个成员按部就班&quot;施展&quot;聊天功能，批量转发message。</span><br><span class="line"></span><br><span class="line">          | -&gt; 读取配置文件&quot;HIM_server.properties&quot;成常量设在config类</span><br><span class="line">          | -&gt; 日志功能初始化</span><br><span class="line">          | -&gt; c3p0连接池初始化</span><br><span class="line">服务端启动 |</span><br><span class="line">          | -&gt; 数据库建表，exist则不建</span><br><span class="line">          | -&gt; 群功能托管类启动</span><br><span class="line">          | -&gt; 主线程while循环中ServerSocket不断接入新的连接，并把它丢入线程池和一个管理ServerThread的&lt;String&quot;IP:Port&quot;-&gt;Thread&gt;的HashMap中</span><br><span class="line">         </span><br><span class="line">          | -&gt; 先用Thread_receiver连接上服务端</span><br><span class="line">客户端启动 | -&gt; 再用Server_API连接上服务端</span><br><span class="line">          | -&gt; 调用Server_API的功能就行了</span><br></pre></td></tr></table></figure></li></ul><p>​ <del>emmmmm，还有什么要说的，想不到了啊，要不上代码吧</del></p><h2 id="开发历程"><a href="#开发历程" class="headerlink" title="开发历程"></a>开发历程</h2><ul><li><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ul><li>Thanks for coming here.</li><li>从Week2到Week11。作为学习JAVA以来的第一个项目，她的意义已经不再局限于一个课设了，就像教育孩子直到成其可用之才。</li><li>很长一段时间我是在不断学习高级技术和推翻自己先前的想法。</li><li>对于代码中魔法值肆虐、包结构过于精简、类名过于”神奇”等现象，请给我提Issue。如果能教一下我该怎么修正错误的习惯，感激不尽！</li><li>这一章虽说是”开发历程”，其实也是摘抄我实验报告的部分罢了，或所尽口舌之快而不得其髓。</li><li>另外，客户端是我的小伙伴写的，所以我无法开源，但已经将程序Demo上传到<a href="https://github.com/zhangt2333/HIM/releases" target="_blank" rel="noopener">release</a></li><li>还有，Gayhub作为最大的<del>同性交友平台</del>，欢迎来邮件~</li></ul></li></ul><ul><li><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4></li></ul><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">本次课程设计立足于市场上热门的即时通讯软件QQ为原型，要求设计了一套自己的聊天软件模式，实现基本的聊天、数据传输功能，并提供了很大的发散空间，可以让我们添加更多的个性设计。</span><br><span class="line"></span><br><span class="line">于此，需求分析方面很简单：</span><br><span class="line"></span><br><span class="line">客户端，用户的使用部分，提供主要的界面和服务请求，如：登录界面、注册界面、信息查看修改界面、主窗体界面、聊天界面等。通过网络发送请求到服务端，并接受服务端反馈，处理、显示结果。</span><br><span class="line"></span><br><span class="line">服务端，提供服务的开启、关闭功能，负责处理核心的业务逻辑，负责连接数据库，保存和读取数据。通过网络接收客户端发送的请求，间接操作数据库，反馈结果于客户端，并用日志记录客户端请求。</span><br><span class="line"></span><br><span class="line">业务方面，提供业务有：注册、登录、登出、查询个人信息、查询分组列表、查询好友列表、昵称查询用户、ID查询用户、批量查询用户、更新好友列表、更新个人信息、更新头像、更改密码、上传文件、下载文件、上传头像、下载头像、发送消息（个人消息、群消息、图片、文件、“你画我猜”请求）、查询未读消息、群号查询群、群名查询群、查询用户所属群、查询群成员列表、上传群文件、查询群文件、创建群、加入群、退出群、更新群消息、更新个人的群名片、发表说说、查询好友说说。</span><br></pre></td></tr></table></figure><ul><li><h4 id="数据库建模"><a href="#数据库建模" class="headerlink" title="数据库建模"></a><a href="https://github.com/zhangt2333/HIM/tree/master/src/com/HIM/server/Db_Init.java" target="_blank" rel="noopener">数据库建模</a></h4></li></ul><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.UserInfo(UserID,Passwd,Sign,PhotoIndex,Nickname,Sex,Birthday,Constellation,ApplyDate)</span><br><span class="line">2.ChatRecord(Index,SendTime,Sender,Type,Receiver,QunID,Content,Fonttype,Fontsize,Fontcolor,Readed)</span><br><span class="line">3.FileInfo(InfoIndex,Type,Size,MD5,Name,Path)</span><br><span class="line">4.LoginInfo(InfoIndex,UserID,IP,Port,LoginTime,Status)</span><br><span class="line">5.MoodRecord(Index,Poster,PostTime,Content)</span><br><span class="line">6.PhotoInfo(InfoIndex,MD5,Path)</span><br><span class="line">7.QunFile(Index,QunID,Uploader,UploadTime,FileIndex)</span><br><span class="line">8.QunInfo(QunID,QunName,PhotoIndex,CreateTime)</span><br><span class="line">9.SubGroup(GroupIndex,UserID,GroupName)</span><br><span class="line">10.UserEmoticon(Index,Fileindex,UserID)</span><br><span class="line">11.UserFriend(UserID,FriendID,GroupIndex,Alias)</span><br><span class="line">12.UserQun(Relation,UserID,QunID,Alias,JoinTime)</span><br></pre></td></tr></table></figure><ul><li><h4 id="数据访问层设计"><a href="#数据访问层设计" class="headerlink" title="数据访问层设计"></a>数据访问层设计</h4></li></ul><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">数据访问层，即将数据库写出读出的相关及其支持方法归分到相应的数据库操作类，在这里，主要是Db_Operate类和Db_Init类，里面提供了类似于register、login、addFriend等写入数据的静态方法，和queryUser、queryQuninfo等查询数据的静态方法。</span><br><span class="line"></span><br><span class="line">   此外，数据库连接的池化管理对数据访问的效率和系统的稳定性有些极大的作用。引入连接池，即对于一个服务端，初始化之时创建初始数量的Connection，每次请求时就直接从连接池拿取，用完放回，拿取之前，连接池对拿取前进行Connection可效性检验，失效或当前无可用连接则新建连接后返回。 </span><br><span class="line">   </span><br><span class="line">   JDK没有提供连接池。我使用了Java比较主流的四大连接池之一C3P0连接池，一个开源的JDBC连接池。使用起来还是蛮简单的。只要封装一个方法，方法里面对配置好的ComboPooledDataSource使用.getConnectons()方法就行了。</span><br></pre></td></tr></table></figure><ul><li><h4 id="缓存数据设计"><a href="#缓存数据设计" class="headerlink" title="缓存数据设计"></a><a href="https://github.com/zhangt2333/HIM/tree/master/src/com/HIM/common/" target="_blank" rel="noopener">缓存数据设计</a></h4></li></ul><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在客户端与客户端通讯的时候，不同功能传输的数据量及类型不一，考虑到数据的存储和项目的可维护性，设计了一些Bean类，在网络IO的时候就可以直接传输对象。设计的Bean类有如下：</span><br><span class="line">Bean_userinfo、Bean_friendinfo、Bean_subgroup、Bean_quninfo、Bean_fileinfo、Bean_message，类之用途如其名。</span><br></pre></td></tr></table></figure><ul><li><h4 id="通讯协议层设计"><a href="#通讯协议层设计" class="headerlink" title="通讯协议层设计"></a>通讯协议层设计</h4></li></ul><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">计算机之间数据传输的常用通讯协议有两种，即TCP和UDP。TCP是可靠的面向连接的通信协议，UDP是不可靠的面向无连接的通信协议。</span><br><span class="line"></span><br><span class="line">在服务端与客户端通讯中，由于多是处理像登录、加好友、查询群等交互的业务，故采用了TCP协议，长连接维护数据流和对象流，从而实现一次连接，随时业务。</span><br><span class="line"></span><br><span class="line">   在客户端与客户端的通讯中，起初在实现聊天功能是时候设想采用UDP协议，客户端从服务端拿到好友们IP和UDP端口，服务端起到一个维护在线用户信息的作用，聊天交给客户端们自己实现。但其网络条件较差时常出现掉包现象和无固定外网ip情况下将无法通讯情况，于是退而继续采用TCP协议，利用”转发”，实现客户端与客户端的连接。</span><br></pre></td></tr></table></figure></div><ul class="post-copyright"><li><strong>本文标题：</strong><a href="https://zhangt.top/Programing/HIM-An-Instant-Messaging-Software/">一个纯Java纯TCP协议的即时通讯程序HIM</a></li><li><strong>本文作者：</strong><a href="https://zhangt.top">ZhangT</a></li><li><strong>本文链接：</strong><a href="https://zhangt.top/Programing/HIM-An-Instant-Messaging-Software/">https://zhangt.top/Programing/HIM-An-Instant-Messaging-Software/</a></li><li><strong>发布时间：</strong>2018-06-03</li><li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li></ul><hr style="height:1px;margin:1rem 0"><div class="level is-size-7 is-uppercase"><div class="level-start"><div class="level-item"><i class="fas fa-tags has-text-grey"></i>&nbsp; <a class="has-link-grey -link" href="/tags/Java/">Java</a>,&nbsp;<a class="has-link-grey -link" href="/tags/MySQL/">MySQL</a></div></div></div></div></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？投喂一下吧！ヾ(●´∀｀●)</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i> </span><span>支付宝</span><div class="qrcode"><img src="/images/alipay.jpg" alt="支付宝"></div></a></div></div></div><div class="card card-transparent"><div class="level post-navigation is-flex-wrap is-mobile"><div class="level-start"><a class="level level-item has-link-grey article-nav-prev" href="/ACM/An-ACM-Contest-Of-NingXia-Silk-Road/"><i class="level-item fas fa-chevron-left"></i> <span class="level-item">ACMLife之宁夏丝绸之路赛</span></a></div></div></div><div class="card"><div class="card-content"><h3 class="title is-5 has-text-weight-normal">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"91f36240e98756fc091e",clientSecret:"20de2f4dadd54bc04ad8db6c1090fb00a9477ac4",id:"ff01bc17ad3753f24d4cabc7ce3991de",repo:"zhangt2333.github.io",owner:"zhangt2333",admin:"zhangt2333",createIssueManually:!1,distractionFreeMode:!1});gitalk.render("comment-container")</script></div></div></div><div class="column is-4-tablet is-4-desktop is-3-widescreen has-order-1 column-left"><div class="card widget"><div class="card-content"><nav class="level" style="margin-bottom:1rem"><div class="level-item has-text-centered"><div><img class="image is-96x96 has-mb-6" src="/images/avatar.png" alt="Zhang T"><p class="is-size-4 is-block">Zhang T</p><p class="is-size-6 is-block">感受我的感受</p><p class="is-size-6 is-flex is-flex-center has-text-grey"><i class="fas fa-map-marker-alt has-mr-7"></i> <span>Qingdao, China</span></p></div></div></nav><nav class="level menu-list is-mobile" style="margin-bottom:1rem"><div class="level-item has-text-centered is-marginless"><a href="/archives/"><p class="heading">文章</p><p class="title has-text-weight-normal">19</p></a></div><div class="level-item has-text-centered is-marginless"><a href="/categories/"><p class="heading">分类</p><p class="title has-text-weight-normal">5</p></a></div><div class="level-item has-text-centered is-marginless"><a href="/tags/"><p class="heading">标签</p><p class="title has-text-weight-normal">21</p></a></div></nav><div class="level"><a class="level-item button is-link is-rounded" href="https://github.com/zhangt2333" target="_blank"><i class="fab fa-github"></i>&nbsp;&nbsp;关注我</a></div></div></div><div class="card widget column-left is-sticky" id="toc"><div class="card-content"><div class="menu" style="max-height:750px;overflow:auto"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#HIM"><span class="has-mr-6">1</span> <span>HIM</span></a><ul class="menu-list"><li><a class="is-flex" href="#目录"><span class="has-mr-6">1.1</span> <span>目录</span></a></li><li><a class="is-flex" href="#课设要求"><span class="has-mr-6">1.2</span> <span>课设要求</span></a></li><li><a class="is-flex" href="#服务端架设"><span class="has-mr-6">1.3</span> <span>服务端架设</span></a><ul class="menu-list"><li><a class="is-flex" href="#Windows"><span class="has-mr-6">1.3.1</span> <span>Windows</span></a></li><li><a class="is-flex" href="#Linux"><span class="has-mr-6">1.3.2</span> <span>Linux</span></a></li></ul></li><li><a class="is-flex" href="#项目介绍"><span class="has-mr-6">1.4</span> <span>项目介绍</span></a><ul class="menu-list"><li><a class="is-flex" href="#目录结构"><span class="has-mr-6">1.4.1</span> <span>目录结构</span></a></li><li><a class="is-flex" href="#服务端原理简单阐述（接下来要施展口技了）"><span class="has-mr-6">1.4.2</span> <span>服务端原理简单阐述（接下来要施展口技了）</span></a></li></ul></li><li><a class="is-flex" href="#开发历程"><span class="has-mr-6">1.5</span> <span>开发历程</span></a><ul class="menu-list"><li><a class="is-flex" href="#前言"><span class="has-mr-6">1.5.1</span> <span>前言</span></a></li><li><a class="is-flex" href="#需求分析"><span class="has-mr-6">1.5.2</span> <span>需求分析</span></a></li><li><a class="is-flex" href="#数据库建模"><span class="has-mr-6">1.5.3</span> <span>数据库建模</span></a></li><li><a class="is-flex" href="#数据访问层设计"><span class="has-mr-6">1.5.4</span> <span>数据访问层设计</span></a></li><li><a class="is-flex" href="#缓存数据设计"><span class="has-mr-6">1.5.5</span> <span>缓存数据设计</span></a></li><li><a class="is-flex" href="#通讯协议层设计"><span class="has-mr-6">1.5.6</span> <span>通讯协议层设计</span></a></li></ul></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start has-text-centered-mobile"><a class="footer-logo is-block has-mb-6" href="/">TTTT&#39;s Blog</a><p class="is-size-7">&copy; 2021 ZhangT&nbsp; Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle"><p class="control"><a class="button is-white is-large" target="_blank" title="GitHub" href="https://github.com/zhangt2333"><i class="fab fa-github"></i></a></p><p class="control"><a class="button is-white is-large" target="_blank" title="E-mail" href="mailto:zhangt2333@gmail.com"><i class="fa fa-envelope-open"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script src="/js/gallery.js" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now</a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"flex"})})</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><script>document.addEventListener("DOMContentLoaded",function(){MathJax.Hub.Config({"HTML-CSS":{matchFontHeight:!1},SVG:{matchFontHeight:!1},CommonHTML:{matchFontHeight:!1},skipTags:["script","noscript","style","textarea","pre","code"],processEscapes:!0,tex2jax:{inlineMath:[["$","$"]]}})})</script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><script src="/js/main.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..."> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)"},CONTENT_URL:"/content.json"}</script><script src="/js/insight.js" defer></script><link rel="stylesheet" href="/css/search.css"><link rel="stylesheet" href="/css/insight.css"><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body></html>